var NodeType;!function(e){e[e.Document=0]="Document",e[e.DocumentType=1]="DocumentType",e[e.Element=2]="Element",e[e.Text=3]="Text",e[e.CDATA=4]="CDATA",e[e.Comment=5]="Comment"}(NodeType||(NodeType={}));var _id=1;function genId(){return _id++}function getCssRulesString(e){try{var t=e.rules||e.cssRules;return t?Array.from(t).reduce(function(e,t){return e+getCssRuleString(t)},""):null}catch(e){return null}}function getCssRuleString(e){return isCSSImportRule(e)?getCssRulesString(e.styleSheet)||"":e.cssText}function isCSSImportRule(e){return"styleSheet"in e}function extractOrigin(e){return(e.indexOf("//")>-1?e.split("/").slice(0,3).join("/"):e.split("/")[0]).split("?")[0]}var URL_IN_CSS_REF=/url\((?:'([^']*)'|"([^"]*)"|([^)]*))\)/gm,RELATIVE_PATH=/^(?!www\.|(?:http|ftp)s?:\/\/|[A-Za-z]:\\|\/\/).*/,DATA_URI=/^(data:)([\w\/\+]+);(charset=[\w-]+|base64).*,(.*)/gi;function absoluteToStylesheet(e,t){return e.replace(URL_IN_CSS_REF,function(e,r,n,i){var o=r||n||i;if(!o)return e;if(!RELATIVE_PATH.test(o))return"url('"+o+"')";if(DATA_URI.test(o))return"url("+o+")";if("/"===o[0])return"url('"+(extractOrigin(t)+o)+"')";var a=t.split("/"),l=o.split("/");a.pop();for(var s=0,u=l;s<u.length;s++){var c=u[s];"."!==c&&(".."===c?a.pop():a.push(c))}return"url('"+a.join("/")+"')"})}function absoluteToDoc(e,t){var r=e.createElement("a");return r.href=t,r.href}function isSVGElement(e){return"svg"===e.tagName||e instanceof SVGElement}function serializeNode(e,t,r,n){switch(e.nodeType){case e.DOCUMENT_NODE:return{type:NodeType.Document,childNodes:[]};case e.DOCUMENT_TYPE_NODE:return{type:NodeType.DocumentType,name:e.name,publicId:e.publicId,systemId:e.systemId};case e.ELEMENT_NODE:var i=!1;"string"==typeof r?i=e.classList.contains(r):e.classList.forEach(function(e){r.test(e)&&(i=!0)});for(var o=e.tagName.toLowerCase(),a={},l=0,s=Array.from(e.attributes);l<s.length;l++){var u=s[l],c=u.name,f=u.value;a[c]="src"===c||"href"===c?absoluteToDoc(t,f):"style"===c?absoluteToStylesheet(f,location.href):f}if("link"===o&&n){var d,p=Array.from(t.styleSheets).find(function(t){return t.href===e.href});(d=getCssRulesString(p))&&(delete a.rel,delete a.href,a._cssText=absoluteToStylesheet(d,p.href))}if("style"===o&&e.sheet&&!e.innerText.trim().length)(d=getCssRulesString(e.sheet))&&(a._cssText=absoluteToStylesheet(d,location.href));if("input"===o||"textarea"===o||"select"===o){f=e.value;"radio"!==a.type&&"checkbox"!==a.type&&f?a.value=f:e.checked&&(a.checked=e.checked)}if("option"===o){var h=e.parentElement;a.value===h.value&&(a.selected=e.selected)}if(i){var m=e.getBoundingClientRect(),g=m.width,y=m.height;a.rr_width=g+"px",a.rr_height=y+"px"}return{type:NodeType.Element,tagName:o,attributes:a,childNodes:[],isSVG:isSVGElement(e)||void 0,needBlock:i};case e.TEXT_NODE:var T=e.parentNode&&e.parentNode.tagName,N=e.textContent,v="STYLE"===T||void 0;return v&&N&&(N=absoluteToStylesheet(N,location.href)),"SCRIPT"===T&&(N="SCRIPT_PLACEHOLDER"),{type:NodeType.Text,textContent:N||"",isStyle:v};case e.CDATA_SECTION_NODE:return{type:NodeType.CDATA,textContent:""};case e.COMMENT_NODE:return{type:NodeType.Comment,textContent:e.textContent||""};default:return!1}}function serializeNodeWithId(e,t,r,n,i,o){void 0===i&&(i=!1),void 0===o&&(o=!0);var a,l=serializeNode(e,t,n,o);if(!l)return console.warn(e,"not serialized"),null;a="__sn"in e?e.__sn.id:genId();var s=Object.assign(l,{id:a});e.__sn=s,r[a]=e;var u=!i;if(s.type===NodeType.Element&&(u=u&&!s.needBlock,delete s.needBlock),(s.type===NodeType.Document||s.type===NodeType.Element)&&u)for(var c=0,f=Array.from(e.childNodes);c<f.length;c++){var d=serializeNodeWithId(f[c],t,r,n,i,o);d&&s.childNodes.push(d)}return s}function snapshot(e,t,r){void 0===t&&(t="rr-block"),void 0===r&&(r=!0);var n={};return[serializeNodeWithId(e,e,n,t,!1,r),n]}var tagMap={script:"noscript",altglyph:"altGlyph",altglyphdef:"altGlyphDef",altglyphitem:"altGlyphItem",animatecolor:"animateColor",animatemotion:"animateMotion",animatetransform:"animateTransform",clippath:"clipPath",feblend:"feBlend",fecolormatrix:"feColorMatrix",fecomponenttransfer:"feComponentTransfer",fecomposite:"feComposite",feconvolvematrix:"feConvolveMatrix",fediffuselighting:"feDiffuseLighting",fedisplacementmap:"feDisplacementMap",fedistantlight:"feDistantLight",fedropshadow:"feDropShadow",feflood:"feFlood",fefunca:"feFuncA",fefuncb:"feFuncB",fefuncg:"feFuncG",fefuncr:"feFuncR",fegaussianblur:"feGaussianBlur",feimage:"feImage",femerge:"feMerge",femergenode:"feMergeNode",femorphology:"feMorphology",feoffset:"feOffset",fepointlight:"fePointLight",fespecularlighting:"feSpecularLighting",fespotlight:"feSpotLight",fetile:"feTile",feturbulence:"feTurbulence",foreignobject:"foreignObject",glyphref:"glyphRef",lineargradient:"linearGradient",radialgradient:"radialGradient"};function getTagName(e){var t=tagMap[e.tagName]?tagMap[e.tagName]:e.tagName;return"link"===t&&e.attributes._cssText&&(t="style"),t}var CSS_SELECTOR=/([^\r\n,{}]+)(,(?=[^}]*{)|\s*{)/g,HOVER_SELECTOR=/([^\\]):hover/g;function addHoverClass(e){return e.replace(CSS_SELECTOR,function(e,t,r){if(HOVER_SELECTOR.test(t)){var n=t.replace(HOVER_SELECTOR,"$1.\\:hover");return t.replace(/\s*$/,"")+", "+n.replace(/^\s*/,"")+r}return e})}function buildNode(e,t){switch(e.type){case NodeType.Document:return t.implementation.createDocument(null,"",null);case NodeType.DocumentType:return t.implementation.createDocumentType(e.name,e.publicId,e.systemId);case NodeType.Element:var r=getTagName(e),n=void 0;for(var i in n=e.isSVG?t.createElementNS("http://www.w3.org/2000/svg",r):t.createElement(r),e.attributes)if(e.attributes.hasOwnProperty(i)&&!i.startsWith("rr_")){var o=e.attributes[i];o="boolean"==typeof o?"":o;var a="textarea"===r&&"value"===i,l="style"===r&&"_cssText"===i;if(l&&(o=addHoverClass(o)),a||l){var s=t.createTextNode(o);n.appendChild(s);continue}if("iframe"===r&&"src"===i)continue;try{e.isSVG&&"xlink:href"===i?n.setAttributeNS("http://www.w3.org/1999/xlink",i,o):n.setAttribute(i,o)}catch(e){}}else e.attributes.rr_width&&(n.style.width=e.attributes.rr_width),e.attributes.rr_height&&(n.style.height=e.attributes.rr_height);return n;case NodeType.Text:return t.createTextNode(e.isStyle?addHoverClass(e.textContent):e.textContent);case NodeType.CDATA:return t.createCDATASection(e.textContent);case NodeType.Comment:return t.createComment(e.textContent);default:return null}}function buildNodeWithSN(e,t,r,n){void 0===n&&(n=!1);var i=buildNode(e,t);if(!i)return null;if(e.type===NodeType.Document&&(t.close(),t.open(),i=t),i.__sn=e,r[e.id]=i,(e.type===NodeType.Document||e.type===NodeType.Element)&&!n)for(var o=0,a=e.childNodes;o<a.length;o++){var l=a[o],s=buildNodeWithSN(l,t,r);s?i.appendChild(s):console.warn("Failed to rebuild",l)}return i}function rebuild(e,t){var r={};return[buildNodeWithSN(e,t,r),r]}export{snapshot,serializeNodeWithId,rebuild,buildNodeWithSN,NodeType};
//# sourceMappingURL=rrweb-snapshot.min.js.map
